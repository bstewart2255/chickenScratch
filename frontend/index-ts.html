<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Signature Modal Flow - TypeScript Version</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Test container */
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
        }
        
        .test-button:hover {
            background: #45a049;
        }
        
        .test-results {
            margin-top: 20px;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            text-align: left;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .test-results.show {
            display: block;
        }
        
        .test-results pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .canvas-container {
            margin: 20px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        
        .canvas-container.show {
            display: block;
        }
        
        #test-canvas {
            background: white;
            display: block;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>TypeScript Frontend Test</h1>
        <p>Test the migrated TypeScript modules</p>
        
        <button class="test-button" onclick="testDeviceCapabilities()">
            Test Device Capabilities
        </button>
        
        <button class="test-button" onclick="testApiClient()">
            Test API Client
        </button>
        
        <button class="test-button" onclick="testSignatureCapture()">
            Test Signature Capture
        </button>
        
        <div class="canvas-container" id="canvasContainer">
            <canvas id="test-canvas"></canvas>
        </div>
        
        <div class="test-results" id="results"></div>
    </div>

    <!-- Load signature_pad library -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    
    <!-- Load compiled TypeScript modules -->
    <script type="module">
        import { DeviceCapabilityDetector } from '../dist/frontend/frontend/DeviceCapabilityDetector.js';
        import { apiClient, ApiError } from '../dist/frontend/frontend/ApiClient.js';
        import { SignatureCapture } from '../dist/frontend/frontend/SignatureCapture.js';
        
        // Make them available globally for button onclick handlers
        window.DeviceCapabilityDetector = DeviceCapabilityDetector;
        window.apiClient = apiClient;
        window.SignatureCapture = SignatureCapture;
        window.ApiError = ApiError;
        
        // Test functions
        window.testDeviceCapabilities = function() {
            const results = document.getElementById('results');
            results.classList.add('show');
            
            try {
                const capabilities = DeviceCapabilityDetector.detectCapabilities();
                results.innerHTML = '<h3>Device Capabilities:</h3><pre>' + 
                    JSON.stringify(capabilities, null, 2) + '</pre>';
                
                // Test pressure detection on a mock event
                const mockEvent = { pressure: 0.5 };
                const hasPressure = DeviceCapabilityDetector.verifyPressureData(mockEvent);
                results.innerHTML += '<p>Pressure data verification (mock): ' + hasPressure + '</p>';
            } catch (error) {
                results.innerHTML = '<h3>Error:</h3><pre>' + error.stack + '</pre>';
            }
        };
        
        window.testApiClient = async function() {
            const results = document.getElementById('results');
            results.classList.add('show');
            
            try {
                results.innerHTML = '<h3>Testing API Client...</h3>';
                
                // Test API URL detection
                results.innerHTML += '<p>API URL: ' + apiClient.getApiUrl() + '</p>';
                
                // Test username check (will fail without backend, but tests the client)
                try {
                    const available = await apiClient.checkUsername('testuser');
                    results.innerHTML += '<p>Username check result: ' + available + '</p>';
                } catch (error) {
                    if (error instanceof ApiError) {
                        results.innerHTML += '<p>API Error (expected without backend): ' + 
                            error.message + ' (Code: ' + error.code + ')</p>';
                    } else {
                        results.innerHTML += '<p>Network error (expected): ' + error.message + '</p>';
                    }
                }
            } catch (error) {
                results.innerHTML = '<h3>Error:</h3><pre>' + error.stack + '</pre>';
            }
        };
        
        window.testSignatureCapture = function() {
            const results = document.getElementById('results');
            const canvasContainer = document.getElementById('canvasContainer');
            results.classList.add('show');
            canvasContainer.classList.add('show');
            
            try {
                // Initialize signature capture
                const signatureCapture = new SignatureCapture('test-canvas', {
                    width: 400,
                    height: 200,
                    backgroundColor: 'white'
                });
                
                results.innerHTML = '<h3>Signature Capture Initialized</h3>';
                results.innerHTML += '<p>Draw on the canvas above to test signature capture</p>';
                results.innerHTML += '<p>Device capabilities: ' + 
                    JSON.stringify(signatureCapture.getDeviceCapabilities(), null, 2) + '</p>';
                
                // Add clear button
                const clearBtn = document.createElement('button');
                clearBtn.className = 'test-button';
                clearBtn.textContent = 'Clear Canvas';
                clearBtn.onclick = () => {
                    signatureCapture.clear();
                    results.innerHTML += '<p>Canvas cleared</p>';
                };
                canvasContainer.appendChild(clearBtn);
                
                // Add get data button
                const getDataBtn = document.createElement('button');
                getDataBtn.className = 'test-button';
                getDataBtn.textContent = 'Get Signature Data';
                getDataBtn.onclick = () => {
                    if (signatureCapture.isEmpty()) {
                        results.innerHTML += '<p>Canvas is empty - please draw something first</p>';
                    } else {
                        const data = signatureCapture.getSignatureData();
                        results.innerHTML += '<h4>Signature Data:</h4><pre>' + 
                            JSON.stringify(data.metrics, null, 2) + '</pre>';
                    }
                };
                canvasContainer.appendChild(getDataBtn);
                
                // Store instance for cleanup
                window.currentSignatureCapture = signatureCapture;
            } catch (error) {
                results.innerHTML = '<h3>Error:</h3><pre>' + error.stack + '</pre>';
            }
        };
    </script>
</body>
</html>